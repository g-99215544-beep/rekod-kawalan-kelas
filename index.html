<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <title>Rekod Pemantauan Kelas SKSA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#047857" />
  <meta name="description" content="Aplikasi Rekod Pemantauan Kelas SK Sri Aman" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Pemantauan SKSA" />
  
  <!-- App Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="app-icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="app-icon-512.png" />
  <link rel="apple-touch-icon" href="app-icon-192.png" />
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;font-family:Poppins,system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;margin:0;padding:0}
    html,body{width:100%;min-height:100%;background:#fff;color:#0f172a}
    .app-shell{width:100%;min-height:100vh;padding:0;margin:0;background:#fff}
    .app-card{background:#fff;border-radius:0;padding:28px 24px 34px;box-shadow:none;min-height:100vh;width:100%}
    @media (min-width: 768px){
      html,body{background:#e5ecf4}
      .app-shell{max-width:500px;margin:20px auto;min-height:auto}
      .app-card{border-radius:20px;min-height:auto;box-shadow:0 10px 30px rgba(15,23,42,.18)}
    }
    .logo-wrap{display:flex;flex-direction:column;align-items:center;margin-bottom:12px;position:relative}
    .logo-wrap img{width:80px;height:80px;border-radius:50%;object-fit:cover;cursor:pointer;box-shadow:0 4px 14px rgba(0,0,0,.25);transition:transform .2s}
    .logo-wrap img:hover{transform:scale(1.05)}
    .logo-wrap h1{margin:10px 0 0;text-align:center;font-size:1.2rem;letter-spacing:.04em;font-weight:600}
    #notifBadge{position:absolute;top:0;right:0;background:red;color:#fff;font-size:12px;padding:2px 6px;border-radius:999px;display:none}
    .status-row{display:flex;justify-content:center;gap:10px;font-size:.85rem;color:#4b5563;margin:6px 0 14px;flex-wrap:wrap}
    .status-pill{display:inline-flex;align-items:center;gap:4px;padding:2px 8px;border-radius:999px;background:#f3f4f6}
    .tab-row{display:inline-flex;border-radius:999px;padding:3px;background:#e5f3ec;margin-bottom:14px}
    .tab-btn{border:none;background:transparent;padding:6px 20px;border-radius:999px;font-size:.85rem;cursor:pointer;font-weight:500;color:#166534}
    .tab-btn.active{background:#059669;color:#fff;box-shadow:0 2px 6px rgba(5,150,105,.45)}
    .input-card{background:#f9fafb;border-radius:16px;padding:14px 12px;border:1px solid #e5e7eb}
    .field{margin-bottom:10px}
    label{font-size:.8rem;font-weight:500;display:flex;align-items:center;gap:6px;margin-bottom:3px;color:#4b5563}
    .required::after{content:" *";color:#e11d48;font-weight:600}
    input[type="text"],input[type="number"],input[type="date"],input[type="password"],select,textarea{width:100%;border-radius:10px;border:1px solid #d1d5db;padding:8px 10px;font-size:.9rem;outline:none;background:#fff}
    textarea{resize:vertical;min-height:70px}
    .btn-submit{margin-top:8px;width:100%;border:none;border-radius:999px;padding:10px 16px;font-size:.95rem;font-weight:600;letter-spacing:.04em;background:#047857;color:#fff;cursor:pointer;box-shadow:0 4px 10px rgba(4,120,87,.45)}
    .section-title{margin:16px 0 8px;font-size:.95rem;font-weight:600;color:#111827}
    .toggle-row{display:inline-flex;background:#e5e7eb;border-radius:999px;padding:3px;margin-bottom:10px}
    .toggle-btn{border:none;background:transparent;padding:5px 14px;border-radius:999px;font-size:.8rem;cursor:pointer;font-weight:500;color:#374151}
    .toggle-btn.active{background:#2563eb;color:#fff}
    .btn-secondary{border:1px solid #d1d5db;background:#fff;color:#374151;padding:7px 14px;border-radius:999px;font-size:.8rem;cursor:pointer}
    .btn-row{margin-top:8px;display:flex;justify-content:flex-end;gap:8px;flex-wrap:wrap}
    .inline-count{display:flex;align-items:center;gap:6px}
    .kehadiran-ratio{font-size:.85rem;font-weight:600;color:#047857;white-space:nowrap;padding:4px 8px;border-radius:999px;background:#ecfdf5;border:1px solid #bbf7d0}
    .kehadiran-subtext{margin-top:3px;font-size:.75rem;color:#6b7280}
    .table-wrapper{max-height:340px;overflow:auto;margin-top:8px;border-radius:12px;border:1px solid #e5e7eb}
    table{width:100%;border-collapse:collapse;font-size:.78rem}
    thead{background:#047857;color:#fff}
    th,td{padding:6px;border-bottom:1px solid #e5e7eb;text-align:left;vertical-align:top}
    tbody tr:nth-child(even){background:#f9fafb}
    .pill-good{background:#e0f2fe;color:#0369a1;padding:2px 6px;border-radius:999px;font-size:.7rem;font-weight:500}
    .pill-bad{background:#fee2e2;color:#b91c1c;padding:2px 6px;border-radius:999px;font-size:.7rem;font-weight:500}
    .empty-state{font-size:.8rem;color:#6b7280;margin-top:4px}
    .multi-select{position:relative}
    .multi-select input[readonly]{cursor:pointer;background-color:#eef2ff}
    .multi-dropdown{position:absolute;left:0;right:0;top:calc(100% + 4px);background:#fff;border-radius:12px;border:1px solid #e5e7eb;box-shadow:0 10px 25px rgba(15,23,42,.18);max-height:260px;overflow:auto;z-index:40;padding:6px 8px}
    .multi-option-row{display:flex;align-items:flex-start;gap:6px;padding:3px 2px;font-size:.8rem;cursor:pointer}
    .multi-option-row input{margin-top:2px;flex-shrink:0}
    .multi-option-row span{flex:1;line-height:1.25}
    .multi-footer{margin-top:4px;font-size:.7rem;color:#6b7280;border-top:1px dashed #e5e7eb;padding-top:4px}
    .multi-empty{font-size:.8rem;color:#6b7280;padding:4px 2px}
    /* Modal */
    .modal-backdrop{position:fixed;inset:0;background:rgba(15,23,42,.6);display:none;align-items:center;justify-content:center;z-index:1000}
    .modal-backdrop.show{display:flex}
    .modal-card{background:#fff;border-radius:18px;padding:20px 22px 18px;width:90%;max-width:400px;box-shadow:0 18px 40px rgba(15,23,42,.45)}
    .modal-card h2{margin:0 0 6px 0;font-size:1.1rem;font-weight:600;color:#111827}
    .modal-card p{margin:0 0 14px 0;font-size:.85rem;color:#4b5563}
    .modal-buttons{margin-top:14px;display:flex;justify-content:flex-end;gap:8px}
    .btn-modal-cancel{border-radius:999px;border:none;padding:7px 16px;background:#e5e7eb;color:#374151;font-size:.82rem;cursor:pointer}
    .btn-modal-primary{border-radius:999px;border:none;padding:7px 18px;background:linear-gradient(135deg,#2563eb,#1d4ed8);color:#fff;font-size:.82rem;font-weight:500;cursor:pointer}
    .install-banner{display:none;position:fixed;bottom:0;left:0;right:0;background:linear-gradient(135deg,#047857,#059669);color:#fff;padding:14px 16px;box-shadow:0 -4px 20px rgba(0,0,0,.2);z-index:999}
    .install-banner.show{display:flex;align-items:center;justify-content:space-between;gap:12px}
    .install-banner-text{font-size:.85rem;flex:1}
    .install-banner-text strong{display:block;font-size:.95rem;margin-bottom:2px}
    .btn-install{background:#fff;color:#047857;border:none;padding:8px 18px;border-radius:999px;font-size:.85rem;font-weight:600;cursor:pointer}
    .btn-dismiss{background:transparent;color:rgba(255,255,255,.8);border:1px solid rgba(255,255,255,.4);padding:6px 12px;border-radius:999px;font-size:.8rem;cursor:pointer}
    .admin-item{border-bottom:1px solid #e5e7eb;padding:10px 0;font-size:.85rem}
    .admin-item strong{display:block;margin-bottom:4px;color:#111827}
    .admin-item button{margin-top:6px;padding:4px 12px;border-radius:999px;border:none;background:#10b981;color:#fff;font-size:.75rem;cursor:pointer}
  </style>
</head>
<body>
<div class="app-shell">
  <div class="app-card">
    <div class="logo-wrap">
      <img id="sksaLogo" src="https://i.imgur.com/AfsVtVG.png" alt="Logo SKSA" />
      <span id="notifBadge">!</span>
      <h1>REKOD PEMANTAUAN KELAS SKSA</h1>
    </div>

    <div class="status-row">
      <div class="status-pill"><span id="headerTarikh">--/--/----</span></div>
      <div class="status-pill"><span id="headerMasa">--:--:--</span></div>
      <div class="status-pill"><span id="headerWaktu">Luar Waktu PdP</span></div>
    </div>

    <div class="tab-row">
      <button id="tabRekod" class="tab-btn active">REKOD SEMASA</button>
      <button id="tabSemak" class="tab-btn">SEMAK REKOD</button>
    </div>

    <!-- REKOD SEMASA -->
    <div id="rekodView">
      <!-- Sub tabs -->
      <div class="tab-row" style="margin-top:10px;">
        <button id="subTabForm" class="tab-btn active">ISI REKOD</button>
        <button id="subTabToday" class="tab-btn">REKOD HARI INI</button>
      </div>

      <!-- Form -->
      <div id="rekodFormView">
        <div class="input-card">
          <div class="field">
            <label class="required">Nama Guru</label>
            <input type="text" id="namaGuru" placeholder="Contoh: Cikgu Sufian" />
          </div>
          <div class="field">
            <label class="required">Kelas</label>
            <select id="kelas"><option value="">Sila Pilih</option></select>
          </div>
          <div class="field">
            <label class="required">Tempat</label>
            <select id="tempat">
              <option value="">Sila Pilih</option>
              <option value="KELAS">KELAS</option>
              <option value="MAKMAL KOMPUTER">MAKMAL KOMPUTER</option>
              <option value="KANTIN">KANTIN</option>
              <option value="SURAU">SURAU</option>
              <option value="DEWAN">DEWAN</option>
              <option value="BILIK JQAF">BILIK JQAF</option>
              <option value="BILIK MUZIK">BILIK MUZIK</option>
              <option value="LAIN-LAIN">LAIN-LAIN</option>
            </select>
          </div>
          <div class="field">
            <label class="required">Jumlah Murid</label>
            <div class="inline-count">
              <input type="number" id="jumlahMurid" min="0" placeholder="Contoh: 28" />
              <span id="kehadiranRatio" class="kehadiran-ratio">/ -</span>
            </div>
            <div id="kehadiranSubtext" class="kehadiran-subtext">Kehadiran hari ini: -</div>
          </div>
          <button class="btn-submit" id="btnSave">HANTAR</button>
        </div>

        <div class="section-title">Maklumat Sahsiah Murid (tidak wajib)</div>
        <div class="input-card">
          <div class="field">
            <label>Nama Murid</label>
            <div class="multi-select" id="namaMuridWrapper">
              <input type="text" id="namaMuridDisplay" placeholder="Pilih murid yang terlibat" readonly />
              <div id="namaMuridDropdown" class="multi-dropdown" style="display:none;">
                <div id="namaMuridOptions"></div>
                <div class="multi-footer">* Senarai murid berdasarkan kelas yang dipilih.</div>
              </div>
            </div>
          </div>

          <div class="toggle-row">
            <button type="button" class="toggle-btn active" id="btnGood">Amalan Baik</button>
            <button type="button" class="toggle-btn" id="btnBad">Kesalahan Disiplin</button>
          </div>

          <div id="panelGood">
            <div class="field">
              <label>Kategori Amalan Baik</label>
              <select id="amalanBaik">
                <option value="">Sila Pilih</option>
                <option value="Adab dan Berbudi Bahasa">ADAB DAN BERBUDI BAHASA</option>
                <option value="Akhlak Mulia">AKHLAK MULIA</option>
                <option value="Kebersihan Diri & Persekitaran">KEBERSIHAN DIRI & PERSEKITARAN</option>
                <option value="Keselamatan Diri">KESELAMATAN DIRI</option>
              </select>
            </div>
            <div class="field">
              <label>Perincian Amalan</label>
              <select id="perincianAmalan">
                <option value="">Sila Pilih</option>
                <option value="Menghargai Diri">MENGHARGAI DIRI</option>
                <option value="Menghormati Guru & Rakan">MENGHORMATI GURU & RAKAN</option>
                <option value="Berkelakuan Sopan">BERKELAKUAN SOPAN</option>
                <option value="Menjaga Kebersihan Kelas">MENJAGA KEBERSIHAN KELAS</option>
                <option value="Menjalankan Tugas yang Diamanahkan">MENJALANKAN TUGAS YANG DIAMANAHKAN</option>
              </select>
            </div>
            <div class="field">
              <label>Keterangan Amalan</label>
              <textarea id="keteranganAmalan" placeholder="Contoh: Menolong rakan yang kesusahan tanpa diminta."></textarea>
            </div>
          </div>

          <div id="panelBad" style="display:none;">
            <div class="field">
              <label>Kategori Kes</label>
              <select id="kategoriKes">
                <option value="">Sila Pilih</option>
                <option value="Barang Larangan">BARANG LARANGAN</option>
                <option value="Kekemasan Diri">KEKEMASAN DIRI</option>
                <option value="Kenakalan">KENAKALAN</option>
                <option value="Ponteng / Lewat Hadir">PONTENG / LEWAT HADIR</option>
                <option value="Kes Khas">KES KHAS</option>
                <option value="Kesalahan Asrama">KESALAHAN ASRAMA</option>
              </select>
            </div>
            <div class="field">
              <label>Punca / Ringkasan Salah Laku</label>
              <input type="text" id="puncaKes" placeholder="Contoh: Membawa telefon bimbit tanpa kebenaran." />
            </div>
            <div class="field">
              <label>Keterangan Kes</label>
              <textarea id="keteranganKes" placeholder="Contoh: Didapati menggunakan telefon bimbit di dalam kelas."></textarea>
            </div>
          </div>

          <div class="btn-row">
            <button type="button" class="btn-secondary" id="btnClearForm">Reset Semua</button>
          </div>
        </div>
      </div>

      <!-- Rekod Hari Ini -->
      <div id="rekodTodayView" style="display:none;">
        <div class="section-title">Jadual Guru Mengikut Waktu (Semua Kelas - Hari Ini)</div>
        <div style="overflow-x:auto;">
          <table border="1" cellpadding="6" cellspacing="0" style="width:100%; border-collapse:collapse;">
            <thead>
              <tr style="background:#047857; color:white;">
                <th>Kelas</th>
                <th>W1</th><th>W2</th><th>W3</th><th>W4</th>
                <th>W5</th><th>W6</th><th>W7</th><th>W8</th><th>W9</th>
              </tr>
            </thead>
            <tbody id="allClassBody">
              <tr><td colspan="10" style="text-align:center;">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- SEMAK REKOD -->
    <div id="semakView" style="display:none;">
      <div class="section-title">Semak Rekod Mengikut Tarikh & Kelas</div>
      <div class="input-card">
        <div class="field">
          <label class="required">Tarikh</label>
          <input type="date" id="semakTarikh" />
        </div>
        <div class="field">
          <label class="required">Kelas</label>
          <select id="semakKelas"><option value="">Sila Pilih</option></select>
        </div>
        <button class="btn-submit" style="margin-top:4px;" id="btnSemakLoad">SEMAK REKOD</button>
        <div id="semakSummary" class="empty-state">Sila pilih tarikh dan kelas untuk semak rekod.</div>
      </div>

      <div class="section-title">Jadual Guru Mengikut Waktu</div>
      <div class="table-wrapper" id="semakTableWrapper" style="display:none;">
        <table>
          <thead><tr id="semakHeadRow"></tr></thead>
          <tbody><tr id="semakBodyRow"></tr></tbody>
        </table>
      </div>

      <div id="semakDetailCard" class="input-card" style="margin-top:10px; display:none;">
        <div class="section-title" style="margin-top:0;">Butiran Rekod</div>
        <div id="semakDetailContent" style="font-size:.82rem;color:#374151;"></div>
      </div>
    </div>
  </div>
</div>

<!-- Admin Login Modal -->
<div id="adminLoginModal" class="modal-backdrop">
  <div class="modal-card">
    <h2>Login Admin</h2>
    <p>Masukkan kata laluan untuk akses panel admin.</p>
    <div class="field">
      <label>Kata Laluan</label>
      <input type="password" id="adminPassword" placeholder="Masukkan kata laluan admin" />
    </div>
    <div class="modal-buttons">
      <button class="btn-modal-cancel" id="btnAdminCancel">Batal</button>
      <button class="btn-modal-primary" id="btnAdminLogin">Login</button>
    </div>
  </div>
</div>

<!-- Admin Panel Modal -->
<div id="adminPanelModal" class="modal-backdrop">
  <div class="modal-card">
    <h2>Admin ‚Äî Laporan Sahsiah</h2>
    <p>Senarai laporan yang perlu tindakan.</p>
    <div id="adminReportList" style="max-height:300px;overflow:auto;"></div>
    <div class="modal-buttons">
      <button class="btn-modal-cancel" id="btnAdminClose">Tutup</button>
    </div>
  </div>
</div>

<!-- Install Banner -->
<div id="installBanner" class="install-banner">
  <div class="install-banner-text">
    <strong>Pasang Aplikasi</strong>
    Muat turun untuk akses lebih pantas
  </div>
  <button class="btn-install" id="btnInstall">Pasang</button>
  <button class="btn-dismiss" id="btnDismiss">Nanti</button>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDbCgDz2vK2BZUpwM3iDWJcPQSptVcNkv4",
  authDomain: "kehadiran-murid-6ece0.firebaseapp.com",
  databaseURL: "https://kehadiran-murid-6ece0-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "kehadiran-murid-6ece0",
  storageBucket: "kehadiran-murid-6ece0.firebasestorage.app",
  messagingSenderId: "223849234784",
  appId: "1:223849234784:web:e1471ded7ea17ba60bde05",
  measurementId: "G-4DY138HKTW"
};

if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}
const db = firebase.database();
</script>

<script>
  // Register Service Worker for PWA
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('./sw.js')
        .then(reg => console.log('Service Worker berjaya didaftarkan:', reg.scope))
        .catch(err => console.log('Service Worker gagal:', err));
    });
  }

  // PWA Install Prompt
  let deferredPrompt;
  const installBanner = document.getElementById('installBanner');
  const btnInstall = document.getElementById('btnInstall');
  const btnDismiss = document.getElementById('btnDismiss');

  window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installBanner.classList.add('show');
  });

  btnInstall.addEventListener('click', async () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    deferredPrompt = null;
    installBanner.classList.remove('show');
  });

  btnDismiss.addEventListener('click', () => {
    installBanner.classList.remove('show');
  });

  window.addEventListener('appinstalled', () => {
    installBanner.classList.remove('show');
    deferredPrompt = null;
  });

  // Time periods
  const periods=[{code:"W1",start:"07:40",end:"08:10"},{code:"W2",start:"08:10",end:"08:40"},{code:"W3",start:"08:40",end:"09:10"},{code:"W4",start:"09:10",end:"09:40"},{code:"W5",start:"09:40",end:"10:10"},{code:"W6",start:"10:10",end:"10:40"},{code:"W7",start:"10:40",end:"11:10"},{code:"W8",start:"11:10",end:"11:40"},{code:"W9",start:"11:40",end:"12:10"},{code:"W10",start:"12:10",end:"12:40"},{code:"W11",start:"12:40",end:"13:10"},{code:"W12",start:"13:10",end:"13:40"}];
  
  function timeToMinutes(str){const[h,m]=str.split(":").map(Number);return h*60+m}
  function formatDate(d){return String(d.getDate()).padStart(2,"0")+"/"+String(d.getMonth()+1).padStart(2,"0")+"/"+d.getFullYear()}
  function formatTime(d){return String(d.getHours()).padStart(2,"0")+":"+String(d.getMinutes()).padStart(2,"0")+":"+String(d.getSeconds()).padStart(2,"0")}
  function getCurrentPeriod(now){const mn=now.getHours()*60+now.getMinutes();for(const p of periods){const s=timeToMinutes(p.start),e=timeToMinutes(p.end);if(mn>=s&&mn<e)return p}return null}
  
  function updateDateTimeUI(){
    const now=new Date();
    document.getElementById("headerTarikh").textContent=formatDate(now);
    document.getElementById("headerMasa").textContent=formatTime(now);
    const p=getCurrentPeriod(now);
    document.getElementById("headerWaktu").textContent=p?p.code:"Luar Waktu PdP";
  }
  setInterval(updateDateTimeUI,1000);
  updateDateTimeUI();

  // Tabs
  const tabRekod=document.getElementById("tabRekod"),tabSemak=document.getElementById("tabSemak"),rekodView=document.getElementById("rekodView"),semakView=document.getElementById("semakView");
  function setTab(tab){
    if(tab==="rekod"){
      tabRekod.classList.add("active");
      tabSemak.classList.remove("active");
      rekodView.style.display="block";
      semakView.style.display="none";
    }else{
      tabRekod.classList.remove("active");
      tabSemak.classList.add("active");
      rekodView.style.display="none";
      semakView.style.display="block";
    }
  }
  tabRekod.addEventListener("click",()=>setTab("rekod"));
  tabSemak.addEventListener("click",()=>setTab("semak"));

  // Sub tabs
  const subTabForm=document.getElementById("subTabForm"),subTabToday=document.getElementById("subTabToday"),rekodFormView=document.getElementById("rekodFormView"),rekodTodayView=document.getElementById("rekodTodayView");
  function setSubTab(tab){
    if(tab==="form"){
      subTabForm.classList.add("active");
      subTabToday.classList.remove("active");
      rekodFormView.style.display="block";
      rekodTodayView.style.display="none";
    }else{
      subTabForm.classList.remove("active");
      subTabToday.classList.add("active");
      rekodFormView.style<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <title>Rekod Pemantauan Kelas SKSA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    *{box-sizing:border-box;font-family:Poppins,sans-serif;margin:0;padding:0}
    body{background:#e5ecf4;color:#0f172a;padding:20px}
    .app-card{background:#fff;border-radius:20px;padding:28px 24px;max-width:500px;margin:0 auto;box-shadow:0 10px 30px rgba(15,23,42,.18)}
    .logo-wrap{text-align:center;margin-bottom:20px;position:relative}
    .logo-wrap img{width:80px;height:80px;border-radius:50%;cursor:pointer;box-shadow:0 4px 14px rgba(0,0,0,.25);transition:transform .2s}
    .logo-wrap img:hover{transform:scale(1.05)}
    #notifBadge{position:absolute;top:0;right:calc(50% - 50px);background:red;color:#fff;font-size:11px;padding:3px 7px;border-radius:999px;display:none;font-weight:600}
    h1{font-size:1.2rem;margin:10px 0}
    .status-row{display:flex;justify-content:center;gap:10px;font-size:.85rem;color:#4b5563;margin:15px 0;flex-wrap:wrap}
    .status-pill{padding:4px 10px;border-radius:999px;background:#f3f4f6}
    .modal-backdrop{position:fixed;inset:0;background:rgba(15,23,42,.6);display:none;align-items:center;justify-content:center;z-index:1000}
    .modal-backdrop.show{display:flex}
    .modal-card{background:#fff;border-radius:18px;padding:24px;width:90%;max-width:400px;box-shadow:0 18px 40px rgba(15,23,42,.45)}
    .modal-card h2{margin:0 0 8px;font-size:1.15rem;color:#111827}
    .modal-card p{margin:0 0 16px;font-size:.88rem;color:#4b5563}
    .field{margin-bottom:12px}
    label{font-size:.82rem;font-weight:500;display:block;margin-bottom:4px;color:#4b5563}
    input[type="password"]{width:100%;border-radius:10px;border:1px solid #d1d5db;padding:10px;font-size:.9rem;outline:none}
    input[type="password"]:focus{border-color:#047857}
    .modal-buttons{margin-top:18px;display:flex;justify-content:flex-end;gap:10px}
    .btn-modal-cancel{border-radius:999px;border:none;padding:8px 18px;background:#e5e7eb;color:#374151;font-size:.85rem;cursor:pointer;font-weight:500}
    .btn-modal-cancel:hover{background:#d1d5db}
    .btn-modal-primary{border-radius:999px;border:none;padding:8px 20px;background:#047857;color:#fff;font-size:.85rem;font-weight:600;cursor:pointer}
    .btn-modal-primary:hover{background:#059669}
    .admin-item{border-bottom:1px solid #e5e7eb;padding:12px 0;font-size:.85rem}
    .admin-item:last-child{border-bottom:none}
    .admin-item strong{display:block;margin-bottom:6px;color:#111827;font-size:.9rem}
    .admin-item .meta{color:#6b7280;font-size:.8rem;margin-bottom:6px}
    .admin-item button{padding:6px 14px;border-radius:999px;border:none;background:#10b981;color:#fff;font-size:.78rem;cursor:pointer;font-weight:500;margin-top:6px}
    .admin-item button:hover{background:#059669}
    .empty-admin{text-align:center;padding:30px 20px;color:#6b7280;font-size:.88rem}
  </style>
</head>
<body>
<div class="app-card">
  <div class="logo-wrap">
    <img id="sksaLogo" src="https://i.imgur.com/AfsVtVG.png" alt="Logo SKSA" title="Klik untuk Admin" />
    <span id="notifBadge">3</span>
    <h1>REKOD PEMANTAUAN KELAS SKSA</h1>
  </div>

  <div class="status-row">
    <div class="status-pill"><span id="headerTarikh">11/01/2026</span></div>
    <div class="status-pill"><span id="headerMasa">15:31:40</span></div>
    <div class="status-pill"><span id="headerWaktu">Luar Waktu PdP</span></div>
  </div>

  <p style="text-align:center;color:#6b7280;font-size:.9rem;margin-top:20px">
    Klik logo di atas untuk akses panel admin
  </p>
</div>

<!-- Admin Login Modal -->
<div id="adminLoginModal" class="modal-backdrop">
  <div class="modal-card">
    <h2>üîê Login Admin</h2>
    <p>Masukkan kata laluan untuk akses panel admin.</p>
    <div class="field">
      <label>Kata Laluan</label>
      <input type="password" id="adminPassword" placeholder="Masukkan kata laluan admin" />
    </div>
    <div class="modal-buttons">
      <button class="btn-modal-cancel" id="btnAdminCancel">Batal</button>
      <button class="btn-modal-primary" id="btnAdminLogin">Login</button>
    </div>
  </div>
</div>

<!-- Admin Panel Modal -->
<div id="adminPanelModal" class="modal-backdrop">
  <div class="modal-card">
    <h2>üë§ Admin Panel</h2>
    <p>Laporan Sahsiah yang memerlukan tindakan</p>
    <div id="adminReportList" style="max-height:350px;overflow:auto;"></div>
    <div class="modal-buttons">
      <button class="btn-modal-cancel" id="btnAdminClose">Tutup</button>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDbCgDz2vK2BZUpwM3iDWJcPQSptVcNkv4",
  authDomain: "kehadiran-murid-6ece0.firebaseapp.com",
  databaseURL: "https://kehadiran-murid-6ece0-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "kehadiran-murid-6ece0",
  storageBucket: "kehadiran-murid-6ece0.firebasestorage.app",
  messagingSenderId: "223849234784",
  appId: "1:223849234784:web:e1471ded7ea17ba60bde05"
};

if (!firebase.apps.length) {
  firebase.initializeApp(firebaseConfig);
}
const db = firebase.database();

// Admin System
let isAdminLoggedIn = false;
const ADMIN_PASSWORD = "admin123";

const logo = document.getElementById("sksaLogo");
const loginModal = document.getElementById("adminLoginModal");
const panelModal = document.getElementById("adminPanelModal");
const passwordInput = document.getElementById("adminPassword");
const btnLogin = document.getElementById("btnAdminLogin");
const btnCancel = document.getElementById("btnAdminCancel");
const btnClose = document.getElementById("btnAdminClose");
const reportList = document.getElementById("adminReportList");
const notifBadge = document.getElementById("notifBadge");

// Logo click handler
logo.addEventListener("click", () => {
  if (!isAdminLoggedIn) {
    loginModal.classList.add("show");
    passwordInput.value = "";
    passwordInput.focus();
  } else {
    loadAdminReports();
    panelModal.classList.add("show");
  }
});

// Login button
btnLogin.addEventListener("click", () => {
  const password = passwordInput.value;
  if (password === ADMIN_PASSWORD) {
    isAdminLoggedIn = true;
    loginModal.classList.remove("show");
    loadAdminReports();
    panelModal.classList.add("show");
    alert("‚úÖ Login berjaya! Selamat datang, Admin.");
  } else {
    alert("‚ùå Kata laluan salah! Cuba lagi.");
    passwordInput.value = "";
    passwordInput.focus();
  }
});

// Enter key for login
passwordInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") {
    btnLogin.click();
  }
});

// Cancel login
btnCancel.addEventListener("click", () => {
  loginModal.classList.remove("show");
  passwordInput.value = "";
});

// Close admin panel
btnClose.addEventListener("click", () => {
  panelModal.classList.remove("show");
});

// Load admin reports from Firebase
function loadAdminReports() {
  reportList.innerHTML = '<p style="text-align:center;color:#6b7280;padding:20px">Loading...</p>';
  
  db.ref("notifications").once("value").then(snapshot => {
    reportList.innerHTML = "";
    
    if (!snapshot.exists()) {
      reportList.innerHTML = '<div class="empty-admin">‚ú® Tiada laporan baharu.<br>Semua laporan telah diselesaikan.</div>';
      return;
    }

    let count = 0;
    snapshot.forEach(child => {
      const key = child.key;
      const data = child.val();
      count++;
      
      const div = document.createElement("div");
      div.className = "admin-item";
      div.innerHTML = `
        <strong>${data.namaMurid || "Tanpa Nama"}</strong>
        <div class="meta">
          ${data.jenis === "baik" ? "‚úÖ Amalan Baik" : "‚ö†Ô∏è Kesalahan Disiplin"} ‚Ä¢ 
          ${data.kelas || "-"} ‚Ä¢ 
          ${data.tarikh || "-"}
        </div>
        <div style="color:#374151;font-size:.82rem;margin-bottom:6px">
          <strong>Kategori:</strong> ${data.kategori || "-"}<br>
          <strong>Keterangan:</strong> ${data.keterangan || "-"}
        </div>
        <button onclick="adminSahkan('${key}')">‚úì Sahkan & Selesai</button>
      `;
      reportList.appendChild(div);
    });
  }).catch(err => {
    reportList.innerHTML = '<div class="empty-admin">‚ùå Ralat memuat data.<br>Sila cuba lagi.</div>';
    console.error("Error loading reports:", err);
  });
}

// Sahkan laporan (remove from list)
window.adminSahkan = function(key) {
  if (confirm("Sahkan laporan ini dan keluarkan dari senarai?")) {
    db.ref("notifications/" + key).remove().then(() => {
      alert("‚úÖ Laporan disahkan!");
      loadAdminReports();
    }).catch(err => {
      alert("‚ùå Gagal sahkan laporan: " + err.message);
    });
  }
};

// Listen for badge updates
db.ref("notifications").on("value", snapshot => {
  const count = snapshot.exists() ? snapshot.numChildren() : 0;
  if (count > 0) {
    notifBadge.textContent = count;
    notifBadge.style.display = "block";
  } else {
    notifBadge.style.display = "none";
  }
});

// Update clock
function updateClock() {
  const now = new Date();
  const tarikh = String(now.getDate()).padStart(2, "0") + "/" + 
                 String(now.getMonth() + 1).padStart(2, "0") + "/" + 
                 now.getFullYear();
  const masa = String(now.getHours()).padStart(2, "0") + ":" + 
               String(now.getMinutes()).padStart(2, "0") + ":" + 
               String(now.getSeconds()).padStart(2, "0");
  
  document.getElementById("headerTarikh").textContent = tarikh;
  document.getElementById("headerMasa").textContent = masa;
}
setInterval(updateClock, 1000);
updateClock();

console.log("‚úÖ SKSA Monitoring App loaded successfully!");
console.log("üîë Admin password: admin123");
console.log("üëÜ Click logo to login as admin");
</script>
</body>
</html>
